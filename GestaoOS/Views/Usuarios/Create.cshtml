@model GestaoOS.Models.Usuario
@using GestaoOS.Services
@{
    ViewData["Title"] = "Criar Novo Usuário";
}

<p class="titlePage"><img class="big icon" src="/Assets/user.png" alt="Icone"> Gerenciar Usuários</p>
<p class="descrption">Cadastre e gerencie os usuarios da sua organização</p>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<article class="card">
    <form asp-action="Create">
            <div asp-validation-summary="All" class="text-danger"></div>

        <div class="inputs">
                <label asp-for="Nome" class="control-label"></label>
                <input asp-for="Nome" class="form-control" />
        </div>
        <div class="inputs">
                <label asp-for="Email" class="control-label"></label>
                <input asp-for="Email" class="form-control" />
        </div>

        <div class="inputs">
                <label for="RoleSelecionada" class="control-label">Perfil</label>
                <select name="RoleSelecionada" id="roleDropdown" class="form-control" asp-items="ViewBag.RolesDisponiveis">
                    <option value="">-- Selecione um Perfil --</option>
                </select>
        </div>

        <div class="inputs" id="especializacaoDiv" style="display: none;">
                <label asp-for="EspecializacaoId" class="control-label">Especialização</label>
                <select asp-for="EspecializacaoId" class="form-control" asp-items="ViewBag.Especializacoes">
                    <option value="">-- Selecione uma Especialização --</option>
                </select>
        </div>

        <div class="inputs">
            <input type="submit" class="submit" value="Criar Usuário" style="min-width: 150px"/>
            <a asp-action="Index" class="btn btn-secondary">Voltar para a Lista</a>
        </div>
    </form>
</article>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            const roleDropdown = $('#roleDropdown');
            const especializacaoDiv = $('#especializacaoDiv');

            function toggleEspecializacao() {
                if (roleDropdown.val() === '@RolesGlobais.Manutencao') {
                    especializacaoDiv.show();
                } else {
                    especializacaoDiv.hide();
                    $('#EspecializacaoId').val(''); // Limpa a seleção se esconder
                }
            }
            toggleEspecializacao();
            roleDropdown.on('change', toggleEspecializacao);
        });
    </script>
}